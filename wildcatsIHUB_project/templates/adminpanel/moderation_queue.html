{% extends 'adminpanel/base_admin.html' %}
{% block title %}Moderation Queue{% endblock %}
{% block content %}

<div class="projects-section">
    <div class="section-header">
        <h2>Moderation Queue</h2>
        <p>Review and resolve reported projects.</p>
    </div>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
        <thead>
            <tr style="background: #f8f9fa; text-align: left; border-bottom: 2px solid #e9ecef;">
                <th style="padding: 12px; font-weight: 600; color: #495057;">Project</th>
                <th style="padding: 12px; font-weight: 600; color: #495057;">Reported By</th>
                <th style="padding: 12px; font-weight: 600; color: #495057;">Reason</th>
                <th style="padding: 12px; font-weight: 600; color: #495057;">Details</th>
                <th style="padding: 12px; font-weight: 600; color: #495057;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr style="border-bottom: 1px solid #e9ecef;">
                <td style="padding: 12px;">
                    <a href="{% url 'project_detail' report.project.id %}" target="_blank" style="font-weight: 600; color: #1e5cff; text-decoration: none;">
                        {{ report.project.title }}
                        <i class="fas fa-external-link-alt" style="font-size: 0.8rem; margin-left: 5px;"></i>
                    </a>
                </td>
                <td style="padding: 12px;">
                    {{ report.reported_by.username|default:"Anonymous" }}
                </td>
                <td style="padding: 12px;">
                    <span class="status-badge rejected" style="background: #ffebee; color: #c62828;">
                        {{ report.get_reason_display }}
                    </span>
                </td>
                <td style="padding: 12px; color: #666; max-width: 300px;">
                    {{ report.description|default:"No details provided." }}
                    <div style="font-size: 0.8rem; color: #999; margin-top: 5px;">
                        {{ report.created_at|timesince }} ago
                    </div>
                </td>
                <td style="padding: 12px;">
                    <form method="POST" action="{% url 'resolve_report' report.id %}" style="display: flex; gap: 8px;">
                        {% csrf_token %}
                        
                        <button type="submit" name="action" value="dismiss" class="btn-sm" style="background: #e9ecef; color: #495057; border: 1px solid #ced4da; cursor: pointer; border-radius: 6px;">
                            Dismiss
                        </button>
                        
                        <button type="submit" name="action" value="delete_project" class="btn-sm" style="background: #dc3545; color: white; border: none; cursor: pointer; border-radius: 6px;" onclick="return confirm('Are you sure? This will permanently delete the project.');">
                            Delete Project
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="empty-state" style="text-align: center; padding: 3rem;">
                    <div style="color: #28a745; font-size: 1.2rem; margin-bottom: 10px;">
                        <i class="fas fa-check-circle" style="font-size: 2rem;"></i>
                    </div>
                    <h3>All caught up!</h3>
                    <p>There are no pending reports.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}