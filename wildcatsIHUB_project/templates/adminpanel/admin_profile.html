{% extends 'adminpanel/base_admin.html' %}
{% load static %}
{% block title %}My Profile{% endblock %}
{% block content %}

<div class="projects-section">
    <div class="section-header">
        <h2>My Profile</h2>
        <p>Manage your account settings and appearance.</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="profile-layout" style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
        {% csrf_token %}

        <div class="profile-card" style="text-align: center; padding: 2rem; background: #f8f9fa; border-radius: 12px; border: 1px solid #e8e8e8;">
            
            <div style="position: relative; width: 120px; height: 120px; margin: 0 auto 1.5rem; border-radius: 50%; overflow: hidden; border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <img id="avatarPreview" 
                     src="{% if user.userprofile.avatar %}{{ user.userprofile.avatar.url }}{% else %}{% static 'avatars/default_profile.png' %}{% endif %}" 
                     alt="Avatar" 
                     style="width: 100%; height: 100%; object-fit: cover;">
            </div>

            <h3 style="margin-bottom: 0.5rem;">{{ user.first_name }} {{ user.last_name }}</h3>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">{{ user.email }}</p>
            <span class="status-badge active">Administrator</span>

            <div style="margin-top: 2rem;">
                <label for="id_avatar" class="btn btn-outline" style="width: 100%; cursor: pointer;">
                    <i class="fas fa-camera" style="margin-right: 8px;"></i> Change Photo
                </label>
                <div style="display: none;">
                    {{ profile_form.avatar }}
                </div>
            </div>
        </div>

        <div class="profile-details">
            <h3 style="margin-bottom: 1.5rem; color: #1a1a1a;">Account Details</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">First Name</label>
                    {{ user_form.first_name }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Last Name</label>
                    {{ user_form.last_name }}
                </div>
            </div>

            <div style="margin-top: 1rem;">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email Address</label>
                {{ user_form.email }}
            </div>

            <div style="margin-top: 1rem;">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                <input type="text" value="{{ user.username }}" disabled class="form-input" style="background: #e9ecef; cursor: not-allowed;">
                <p style="font-size: 0.8rem; color: #888; margin-top: 5px;">Username cannot be changed.</p>
            </div>

            <hr style="margin: 2rem 0; border: 0; border-top: 1px solid #e8e8e8;">

            <div class="project-actions" style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </form>
</div>

<script>
    document.getElementById('id_avatar').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });
</script>

{% endblock %}