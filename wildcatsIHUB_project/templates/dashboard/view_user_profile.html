{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ viewed_user.username }}'s Profile - Wildcats iHUB</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/view_user_profile.css' %}">
</head>
<body>
    <div class="profile-container">
        <!-- Professional Header Section -->
        <div class="profile-header">
            <!-- Back to Home Button - Top Left -->
            <div class="back-to-home-wrapper">
                <a href="{% url 'home' %}" class="back-btn" title="Back to Home">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            
            <div class="header-background"></div>
            <div class="header-content">
                <div class="user-avatar-section">
                    <div class="avatar-wrapper">
                        <div class="avatar-img"></div>
                    </div>
                </div>
                
                <div class="user-info-section">
                    <div class="user-main-info">
                        <!-- USER NAME DISPLAY -->
                        <h1 class="user-name">
                            {% if user_name and user_name.strip %}
                                {{ user_name }}
                            {% elif viewed_user.get_full_name %}
                                {{ viewed_user.get_full_name }}
                            {% else %}
                                {{ viewed_user.username }}
                            {% endif %}
                        </h1>
                        
                        {% if is_own_profile %}
                        <div class="header-buttons">
                            <a href="{% url 'user_profile' %}" class="edit-profile-btn">
                                <i class="fas fa-edit"></i> My Profile
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Simple Title -->
                    <p class="user-title">
                        {% if user_title and user_title.strip %}
                            {{ user_title }}
                        {% elif user_major and user_major.strip %}
                            {{ user_major }} Student
                        {% else %}
                            Student
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-code"></i></div>
                <div class="stat-content">
                    <span class="stat-number">{{ projects.count }}</span>
                    <span class="stat-label">Projects</span>
                </div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="profile-content">
            <div class="full-width-column">
                <div class="info-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-folder-open"></i>
                            <h3>Projects ({{ projects.count }})</h3>
                        </div>
                        {% if is_own_profile %}
                        <a href="{% url 'submit_project' %}" class="add-project-btn">
                            <i class="fas fa-plus"></i> Add Project
                        </a>
                        {% endif %}
                    </div>
                    
                    <div class="card-content">
                        {% if projects %}
                            <div class="projects-grid">
                                {% for project in projects %}
                                    <div class="project-card">
                                        <div class="project-header">
                                            <h4 class="project-title">{{ project.title }}</h4>
                                            <span class="project-date">
                                                <i class="fas fa-calendar"></i>
                                                {{ project.created_at|date:"M Y" }}
                                            </span>
                                        </div>
                                        
                                        {% if project.description %}
                                        <p class="project-description">
                                            {{ project.description|truncatechars:150 }}
                                        </p>
                                        {% endif %}
                                        
                                        {% if project.tech_used %}
                                        <div class="project-technologies">
                                            {% for tech in project.tech_used.split %}
                                                {% if tech.strip %}
                                                <span class="tech-tag">{{ tech.strip }}</span>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        
                                        <div class="project-footer">
                                            {% if project.github_url or project.live_demo %}
                                            <div class="project-links">
                                                {% if project.github_url %}
                                                <a href="{{ project.github_url }}" target="_blank" class="project-link">
                                                    <i class="fab fa-github"></i> Code
                                                </a>
                                                {% endif %}
                                                {% if project.live_demo %}
                                                <a href="{{ project.live_demo }}" target="_blank" class="project-link">
                                                    <i class="fas fa-external-link-alt"></i> Demo
                                                </a>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                            
                                            <a href="{% url 'view_project' project.id %}" class="view-project-btn">
                                                View Details
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <h4>No Projects Yet</h4>
                                <p>
                                    {% if is_own_profile %}
                                    Share your work by adding your first project!
                                    {% else %}
                                    This user hasn't shared any projects yet.
                                    {% endif %}
                                </p>
                                {% if is_own_profile %}
                                <a href="{% url 'submit_project' %}" class="btn-primary">
                                    <i class="fas fa-plus"></i> Create Your First Project
                                </a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set avatar initials
        document.addEventListener('DOMContentLoaded', function() {
            const avatar = document.querySelector('.avatar-img');
            
            if (avatar) {
                // Get initials from multiple sources
                let displayName = "{{ user_name|default:'' }}";
                let firstName = "{{ viewed_user.first_name|default:'' }}";
                let lastName = "{{ viewed_user.last_name|default:'' }}";
                let username = "{{ viewed_user.username|default:'' }}";
                
                let initials = '';
                
                // Try user_name first
                if (displayName && displayName.trim()) {
                    const nameParts = displayName.split(' ');
                    if (nameParts.length >= 2) {
                        initials = nameParts[0][0] + nameParts[1][0];
                    } else if (nameParts.length === 1) {
                        initials = nameParts[0][0];
                    }
                }
                
                // Fallback to first and last name
                if (!initials && (firstName || lastName)) {
                    initials = (firstName ? firstName[0] : '') + (lastName ? lastName[0] : '');
                }
                
                // Fallback to username
                if (!initials && username) {
                    initials = username.substring(0, 2).toUpperCase();
                }
                
                // Final fallback
                if (!initials) {
                    initials = 'U';
                }
                
                avatar.textContent = initials.toUpperCase();
                
                // Style the avatar
                avatar.style.cssText = `
                    width: 120px;
                    height: 120px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 40px;
                    font-weight: 600;
                    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                    border: 4px solid white;
                `;
            }
        });
    </script>
</body>
</html>